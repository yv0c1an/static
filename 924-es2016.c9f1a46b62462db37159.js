(self.webpackChunkwlc_site=self.webpackChunkwlc_site||[]).push([[924],{54756:function(t,e,i){"use strict";var s=i(74228);e.Z=function(t,e){return null==t||(0,s.Z)(t,e)}},48939:function(t,e,i){"use strict";var s;i.d(e,{L:function(){return s},T:function(){return r}}),function(t){t.RecommendedListVisibility="RECOMMENDED_LIST_VISIBILITY"}(s||(s={}));const r={moduleName:"",class:"wlc-recommended-bonuses",componentName:"wlc-recommended-bonuses",common:{useQuery:!1},useNoDataText:!1}},87924:function(t,e,i){"use strict";i.d(e,{hh:function(){return r.h},dB:function(){return n.d},fs:function(){return r.f},Ll:function(){return s.L}});var s=i(48939),r=i(92375),n=(i(21317),i(97176))},21317:function(t,e,i){"use strict";i.d(e,{r:function(){return C}});var s=i(64762),r=i(70258),n=i(55429),a=i(56298),o=i(52182),u=i(6641),d=i(84383),c=i(2369),h=i(54756),l=i(85218),g=i(29114),v=i(65146),m=i(74663),b=i(692),S=i(20331),y=i(13594),p=i(5237),E=i(57387);class C extends r.zx{constructor(t,e,i,s,r,n){super({from:(0,a.Z)({model:"Bonus"},t)}),this.ConfigService=i,this.cachingService=s,this.translate=r,this.bonusesService=n,this.isReady=!0,this.isChoose=!1,this.regEvents=["deposit first","registration","verification"],this.depEvents=["deposit","deposit first","deposit repeated","deposit sum"],this.welcomeEvents=["registration","deposit first"],this.data=this.modifyData(e),this.userCurrency=this.ConfigService.get("appConfig.user.currency")||"EUR",this._imageUrl=this.image.length?`url(${this.image})`:"",this._imageOtherUrl=this.imageOther?`url(${this.imageOther})`:"",this._tag=this.getTag(),this.$descriptionClean=this.data.Description.replace(/<[^>]*>/g,"")}set data(t){super.data=t,this.$isDep=-1!==this.depEvents.indexOf(this.data.Event),this.$isReg=-1!==this.regEvents.indexOf(this.data.Event)}get data(){return super.data}set userCurrency(t){this._userCurrency=t}get active(){return!!this.data.Active}get affiliateSystem(){return this.data.AffiliateSystem}get affiliateUrl(){return this.data.AffiliateUrl}get allowCatalog(){return!!(0,E.Z)(this.data.AllowCatalog)}get allowStack(){return!!(0,E.Z)(this.data.AllowStack)}get awardWageringTotal(){return this.data.AwardWageringTotal}get amountMax(){return this.data.AmountMax}get amountMin(){return this.data.AmountMin}get balance(){return this.data.Balance}get block(){return(0,E.Z)(this.data.Block)}get bonus(){return(0,E.Z)(this.data.Bonus)}get bonusAwarded(){return(0,E.Z)(this.data.BonusAwarded)}get bonusBalance(){return(0,E.Z)(this.data.BonusBalance)}get bonusType(){return this.data.BonusType}get bonusWinning(){return(0,E.Z)(this.data.BonusWinning)}get currency(){return this.data.Currency}get description(){return this.data.Description}get descriptionClean(){return this.$descriptionClean}get disableCancel(){return!!(0,E.Z)(this.data.DisableCancel)}get date(){return this.data.Date}get event(){return this.data.Event}get eventAmount(){return(0,E.Z)(this.data.EventAmount)}get experienceAction(){return this.data.ExperienceAction}get experiencePoints(){return(0,E.Z)(this.data.ExperiencePoints)}get expire(){return this.data.Expire}get expireDate(){return this.data.ExpireDate}get expireDays(){return(0,E.Z)(this.data.ExpireDays)}get expireAction(){return this.data.ExpireAction}get end(){return this.data.End}get ends(){return this.data.Ends}get freeroundComplete(){return(0,E.Z)(this.data.FreeroundComplete)}get freeroundCount(){return(0,E.Z)(this.data.FreeroundCount)}get freeRoundWagering(){return(0,E.Z)(this.data.FreeRoundWagering)}get freeroundWinning(){return(0,E.Z)(this.data.FreeroundWinning)}get group(){return this.hasPromoCode?gettext("Promocode"):this.$isReg?gettext("Welcome bonus"):this.data.Group}get id(){return(0,E.Z)(this.data.ID)}get idActivator(){return this.data.IDActivator}get idPiFilter(){return this.data.IDPiFilter}get image(){return this.data.Image}get imageUrl(){return this._imageUrl}get imageOther(){return this.data.Image_other}get imageOtherUrl(){return this._imageOtherUrl}get imagePromo(){return this.data.Image_promo.length?this.data.Image_promo:this.data.Image}get imageReg(){return this.data.Image_reg||this.data.Image}get imageStore(){return this.data.Image_store}get inventoried(){return!!this.data.Inventoried}get isInventory(){return!!(0,E.Z)(this.data.IsInventory)}get LBID(){return this.data.LBID}get limitation(){return this.data.Limitation}get loyaltyPoints(){return(0,E.Z)(this.data.LoyaltyPoints)}get maxBet(){var t,e,i,s,r;return(0,E.Z)(this.data.MaxBet[this._userCurrency])||(0,E.Z)(null===(t=this.data.MaxBet)||void 0===t?void 0:t.EUR)||(0,E.Z)(null===(i=null===(e=this.data.Conditions)||void 0===e?void 0:e.MaxBet)||void 0===i?void 0:i.Currency)||(0,E.Z)(null===(r=null===(s=this.data.Conditions)||void 0===s?void 0:s.MaxBet)||void 0===r?void 0:r.EUR)||0}get minBet(){var t,e,i,s,r;return(0,E.Z)(this.data.MinBet[this._userCurrency])||(0,E.Z)(null===(t=this.data.MinBet)||void 0===t?void 0:t.EUR)||(0,E.Z)(null===(i=null===(e=this.data.Conditions)||void 0===e?void 0:e.MinBet)||void 0===i?void 0:i.Currency)||(0,E.Z)(null===(r=null===(s=this.data.Conditions)||void 0===s?void 0:s.MinBet)||void 0===r?void 0:r.EUR)||0}get name(){return this.data.Name}get promoCode(){return(0,p.Z)(this.data.PromoCode)?"":this.data.PromoCode}get hasPromoCode(){return(0,p.Z)(this.data.PromoCode)?!!this.data.PromoCode:!!this.data.PromoCode.length}get promoCodeUsed(){return this.data.PromoCodeUsed}get realWinning(){return(0,E.Z)(this.data.RealWinning)}get releaseWageringTotal(){return this.data.ReleaseWageringTotal}get results(){return this.data.Results}get selected(){return!!this.data.Selected}get sportSettings(){return this.data.SportSettings}get status(){return(0,E.Z)(this.data.Status)}get starts(){return this.data.Starts}get target(){return this.data.Target}get terms(){return this.data.Terms}get totalWinning(){return(0,E.Z)(this.data.TotalWinning)}get type(){return this.data.Type}get wagering(){return(0,E.Z)(this.data.Wagering)}get wageringLeft(){return(0,E.Z)(this.data.WageringLeft)}get wageringTo(){return this.data.WageringTo}get wageringTotal(){return(0,E.Z)(this.data.WageringTotal)}get wageringType(){return this.data.WageringType}get conditions(){return this.data.Conditions||{}}get isActive(){return 0!==this.status&&this.active}get isDeposit(){return this.$isDep}get isWelcomeBonus(){return(0,l.Z)(this.welcomeEvents,this.data.Event)}get isSubscribed(){return 1==this.status&&this.selected&&!this.active}get canSubscribe(){return 1==this.status&&!this.selected&&!this.active&&!this.inventoried}get canUnsubscribe(){return this.isSubscribed||this.inventoried}get isDisabled(){return-99===this.status}get minDeposit(){var t,e,i,s,r;return(0,E.Z)(this.amountMin[this._userCurrency])||(0,E.Z)(null===(t=this.amountMin)||void 0===t?void 0:t.EUR)||(0,E.Z)(null===(i=null===(e=this.conditions)||void 0===e?void 0:e.AmountMin)||void 0===i?void 0:i.Currency)||(0,E.Z)(null===(r=null===(s=this.conditions)||void 0===s?void 0:s.AmountMin)||void 0===r?void 0:r.EUR)||0}get maxDeposit(){var t,e,i,s,r;return(0,E.Z)(this.amountMax[this._userCurrency])||(0,E.Z)(null===(t=this.amountMax)||void 0===t?void 0:t.EUR)||(0,E.Z)(null===(i=null===(e=this.conditions)||void 0===e?void 0:e.AmountMax)||void 0===i?void 0:i.Currency)||(0,E.Z)(null===(r=null===(s=this.conditions)||void 0===s?void 0:s.AmountMax)||void 0===r?void 0:r.EUR)||0}get multiplier(){var t,e;if("relative"===(null===(t=this.results[this.target])||void 0===t?void 0:t.Type))return(0,E.Z)(null===(e=this.results[this.target])||void 0===e?void 0:e.Value)/100}get maxWin(){var t,e,i,s,r;return(0,E.Z)(null===(e=null===(t=this.conditions)||void 0===t?void 0:t.MaxBonusWin)||void 0===e?void 0:e.Currency)||(0,E.Z)(null===(s=null===(i=this.conditions)||void 0===i?void 0:i.MaxBonusWin)||void 0===s?void 0:s.EUR)||(0,E.Z)(null===(r=this.conditions)||void 0===r?void 0:r.MaxBonusWinCoef)||0}get isMaxWinRelative(){var t,e,i;return!(null===(e=null===(t=this.conditions)||void 0===t?void 0:t.MaxBonusWin)||void 0===e?void 0:e.EUR)&&!!(null===(i=this.conditions)||void 0===i?void 0:i.MaxBonusWinCoef)}get limitAmount(){var t,e,i;if("relative"===this.results[this.target].Type)return(0,E.Z)(null===(e=null===(t=this.results)||void 0===t?void 0:t.bonus)||void 0===e?void 0:e.LimitValue[this._userCurrency])||(0,E.Z)(null===(i=this.results[this.target].LimitValue)||void 0===i?void 0:i.EUR)||0}get isLimitAmountEUR(){var t,e,i,s,r;return!(null===(e=null===(t=this.results)||void 0===t?void 0:t.balance)||void 0===e?void 0:e.LimitValue[this._userCurrency])&&!!(null===(r=null===(s=null===(i=this.results)||void 0===i?void 0:i.balance)||void 0===s?void 0:s.LimitValue)||void 0===r?void 0:r.EUR)}get wager(){var t,e,i,s;const r=this.results[this.target];return"balance"===this.target?(0,E.Z)(null===(e=null===(t=this.results)||void 0===t?void 0:t.balance)||void 0===e?void 0:e.ReleaseWagering)||0:(0,E.Z)(null===(i=null==r?void 0:r.AwardWagering)||void 0===i?void 0:i.COEF)||(0,E.Z)(null==r?void 0:r.AwardWagering[this._userCurrency])||(0,E.Z)(null===(s=null==r?void 0:r.AwardWagering)||void 0===s?void 0:s.EUR)||0}get isWagerAbsolute(){var t;return"balance"!==this.target&&"absolute"===(null===(t=this.results[this.target])||void 0===t?void 0:t.WageringType)}get isWagerEUR(){var t;const e=this.results[this.target];if(this.isWagerAbsolute)return!(null==e?void 0:e.AwardWagering[this._userCurrency])&&!!(null===(t=null==e?void 0:e.AwardWagering)||void 0===t?void 0:t.EUR)}get value(){var t,e,i;const s=this.results[this.target];return s?"loyalty"===this.target||"experience"===this.target?"relative"===(null==s?void 0:s.Type)?(0,E.Z)(null==s?void 0:s.Value):(0,E.Z)(null===(t=null==s?void 0:s.Value)||void 0===t?void 0:t.EUR):(0,E.Z)(null==s?void 0:s.Value[this._userCurrency])||(0,E.Z)(null===(e=null==s?void 0:s.Value)||void 0===e?void 0:e.Currency)||(0,E.Z)(null===(i=null==s?void 0:s.Value)||void 0===i?void 0:i.EUR)||(0,E.Z)(null==s?void 0:s.Value):0}get limitationText(){let t="";switch(this.limitation){case"winevent":t=gettext("Winnings + Deposit");break;case"win":t=gettext("Winnings");break;case"all":t=gettext("Full lock");break;default:t=gettext("No lock")}return t}get stackingText(){return this.allowStack?"Allowed":"Restricted"}get statusText(){return this.isActive?"Active":this.isSubscribed?"Subscribe":this.inventoried?"Inventory":""}get viewTarget(){const t=this.results[this.target];return t?"relative"===(null==t?void 0:t.Type)?"relative":this.target:"default"}get expirationTimeLuxon(){const t=n.ou.fromSQL(this.data.Expire);return t.plus({minutes:t.offset})}get tag(){return this._tag}getImageByType(t="default"){switch(t){case"reg":return this.imageReg;case"store":return this.imageStore;case"promo":return this.imagePromo;case"other":return this.imageOther}return this.image}getProgress(t){let e;return e=this.wageringTotal?this.wagering/this.wageringTotal*100:this.wagering?0:100,t?(0,v.Z)(e):e}expirationTime(t="D T"){const e=n.ou.fromSQL(this.data.Expire);return e.plus({minutes:e.offset}).setLocale(e.locale).toFormat(t)}addToCache(t){var e,i;return(0,s.__awaiter)(this,void 0,void 0,function*(){const s=this.results[this.target];if("sign up"===this.event&&"subscribe"===t&&("balance"===this.target&&"0"===(0,S.Z)(null==s?void 0:s.ReleaseWagering)||"balance"!==this.target&&("0"===(0,S.Z)(null===(e=null==s?void 0:s.AwardWagering)||void 0===e?void 0:e.COEF)||"0"===(0,S.Z)(null===(i=null==s?void 0:s.AwardWagering)||void 0===i?void 0:i.EUR))))return;let r;try{r=(yield this.cachingService.get("bonuses"))||{}}catch(n){r={}}r.hasOwnProperty(t)&&(0,m.Z)(r[t])&&!(0,l.Z)(r[t],this.id)?r[t].push(this.id):r[t]=[this.id],(0,g.Z)(r,(e,i)=>{i!==t&&((0,m.Z)(r[i])?(0,c.Z)(e,t=>t===this.id):(0,h.Z)(r,i))}),this.cachingService.set("bonuses",r,!0,Number.MAX_SAFE_INTEGER)})}setFromCache(){return(0,s.__awaiter)(this,void 0,void 0,function*(){let t;try{t=(yield this.cachingService.get("bonuses"))||{}}catch(e){t={}}(0,g.Z)(t,(e,i)=>{if((0,m.Z)(e)&&0!==e.length){if((0,l.Z)(e,this.id))switch(i){case"cancel":this.active?(this.data.Active=0,this.data.Status=-99):(0,c.Z)(e,t=>t===this.id);break;case"subscribe":this.selected?(0,c.Z)(e,t=>t===this.id):(this.data.Selected=1,this.data.Status=-99);break;case"unsubscribe":this.selected?(this.data.Selected=0,this.data.Status=-99):(0,c.Z)(e,t=>t===this.id);break;case"inventory":this.inventoried?(this.data.Inventoried=0,this.data.Status=-99):(0,c.Z)(e,t=>t===this.id)}}else(0,h.Z)(t,i)}),0!==(0,d.Z)(t)?this.cachingService.set("bonuses",t,!0,Number.MAX_SAFE_INTEGER):this.cachingService.clear("bonuses")})}gamesList(t){const e=t?"1":"0";return this.data.GamesRestrictType===e?(0,o.Z)((0,u.Z)(this.data.IDGames),t=>(0,E.Z)(t)):[]}categoriesList(t){const e=t?"1":"0";return this.data.CategoriesRestrictType===e?(0,o.Z)((0,u.Z)(this.data.IDCategories),t=>(0,E.Z)(t)):[]}modifyData(t){const e=["balance","freerounds","loyalty","experience"];return!t.Target&&(0,b.Z)(t.Results)&&(t.Target="",(0,g.Z)(t.Results,(e,i)=>{t.Target+=i,t.Target+=" "})),t.Target&&(0,y.Z)(t.Target)&&(0,g.Z)(e,e=>{-1!==t.Target.indexOf(e)&&(t.Target=e)}),t.ExpireDays=t.ExpireDays||t.Expire,t}getTag(){return this.isActive?gettext("Active"):this.isSubscribed?gettext("Subscribed"):this.inventoried?gettext("Inventoried"):this.hasPromoCode?gettext("Promo code"):this.isWelcomeBonus?gettext("Welcome"):""}}},29448:function(t,e,i){"use strict";i.d(e,{d:function(){return f}});var s=i(64762),r=i(88720),n=i(5469),a=i(26215),o=i(34022),u=i(46782),d=i(21317),c=i(70258),h=i(52182),l=i(84383),g=i(54756),v=i(85218),m=i(29114),b=i(74663),S=i(692),y=i(54252),p=i(77709),E=i(82560),C=i(72545);let f=class{constructor(t,e,i,s,r,n){this.cachingService=t,this.dataService=e,this.eventService=i,this.configService=s,this.logService=r,this.translate=n,this.storeBonuses=[],this.promoBonus=null,this.dbPromoUrl="promocode",this.bonuses=[],this.activeBonuses=[],this.historyBonuses=[],this.subjects={bonuses$:new a.X(null),active$:new a.X(null),history$:new a.X(null),store$:new a.X(null)},this.useForbidUserFields=this.configService.get("$loyalty.useForbidUserFields"),this.depEvents=["deposit","deposit first","deposit repeated","deposit sum"],this.regEvents=["deposit first","registration","verification"],this.queryPromises={active:!1,history:!1,store:!1,any:!1},this.registerMethods(),this.setSubscribers(),this.configService.get({name:"$user.userProfile$"}).subscribe(t=>{this.profile=t})}get hasBonuses(){return!!this.bonuses.length}getSubscribe(t){return t.useQuery&&!this.queryPromises[(null==t?void 0:t.type)||"any"]&&this.queryBonuses(!0,null==t?void 0:t.type),this.getObserver(null==t?void 0:t.type).pipe((null==t?void 0:t.until)?(0,u.R)(null==t?void 0:t.until):(0,o.z)()).subscribe(t.observer)}getObserver(t){let e;switch(t){case"active":e=this.subjects.active$;break;case"history":e=this.subjects.history$;break;case"store":e=this.subjects.store$;break;default:e=this.subjects.bonuses$}return e.asObservable()}filterBonuses(t,e){return(0,y.Z)(t,t=>{const i=t.status,s=t.active,r=t.allowCatalog,n=t.selected,a=t.hasPromoCode,o=t.inventoried;if(!i)return!1;switch(e){case"all":return(r||!r&&(n||s))&&(!a||a&&(n||s));case"deposit":return(r||!r&&(n||s))&&(!a||a&&(n||s))&&-1!==this.depEvents.indexOf(t.event);case"reg":return(r||!r&&(n||s))&&(!a||a&&(n||s))&&-1!==this.regEvents.indexOf(t.event);case"main":return!s&&(!a||a&&n)&&(r||!r&&n)&&!o;case"promocode":return a&&!n;case"inventory":return o&&!s;case"active":return t.isActive}return!0})}getBonusesByCode(t){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{let e=[];return e=(yield this.queryBonuses(!1,null,t)).filter(t=>1==t.status&&!t.selected),(0,m.Z)(e,e=>{e.data.PromoCode=t}),e}catch(e){return this.logService.sendLog({code:"10.0.2",data:e}),[]}})}getBonus(t){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{const e=yield this.dataService.request({name:"bonusById",system:"bonuses",url:`/bonuses/${t}`,type:"GET"});if((0,S.Z)(e.data))return new d.r({service:"BonusesService",method:"getBonus"},e.data,this.configService,this.cachingService,this.translate,this);this.logService.sendLog({code:"10.0.1",data:e.data})}catch(e){this.logService.sendLog({code:"10.0.1",data:e})}})}subscribeBonus(t){return(0,s.__awaiter)(this,void 0,void 0,function*(){t.data.PromoCode=t.data.PromoCode||"";const e={ID:t.id,PromoCode:t.promoCode,Selected:1};try{const i=yield this.dataService.request({name:"bonusSubscribe",system:"bonuses",url:`/bonuses/${t.id}`,type:"POST",mapFunc:e=>(0,s.__awaiter)(this,void 0,void 0,function*(){return yield this.prepareBonusActionData(e,t,"subscribe")}),events:{success:"BONUS_SUBSCRIBE_SUCCEEDED",fail:"BONUS_SUBSCRIBE_FAILED"}},e);return this.showSuccess(gettext("Bonus success"),gettext("Bonus subscribe success")),i.data}catch(i){this.showError(gettext("Bonus error"),null==i?void 0:i.errors)}})}unsubscribeBonus(t){return(0,s.__awaiter)(this,void 0,void 0,function*(){const e={ID:t.id,Selected:0};try{const i=yield this.dataService.request({name:"bonusSubscribe",system:"bonuses",url:`/bonuses/${t.id}`,type:"POST",mapFunc:e=>(0,s.__awaiter)(this,void 0,void 0,function*(){return yield this.prepareBonusActionData(e,t,"unsubscribe")}),events:{success:"BONUS_UNSUBSCRIBE_SUCCEEDED",fail:"BONUS_UNSUBSCRIBE_FAILED"}},e);return this.showSuccess(gettext("Bonus success"),gettext("Bonus unsubscribe success")),i.data}catch(i){this.showError(gettext("Bonus error"),null==i?void 0:i.errors)}})}cancelBonus(t){return(0,s.__awaiter)(this,void 0,void 0,function*(){try{const e=yield this.dataService.request({name:"bonusCancel",system:"bonuses",url:`/bonuses/${t.id}`,type:"DELETE",mapFunc:e=>(0,s.__awaiter)(this,void 0,void 0,function*(){return yield this.prepareBonusActionData(e,t,"cancel")}),events:{success:"BONUS_CANCEL_SUCCEEDED",fail:"BONUS_CANCEL_FAILED"}});return this.showSuccess(gettext("Bonus success"),gettext("Bonus cancel success")),e.data}catch(e){this.showError(gettext("Bonus error"),null==e?void 0:e.errors)}})}takeInventory(t){return(0,s.__awaiter)(this,void 0,void 0,function*(){const e={ID:t.id,type:"take"};try{const i=yield this.dataService.request({name:"bonusTake",system:"bonuses",url:`/bonuses/${t.id}`,type:"PUT",mapFunc:e=>(0,s.__awaiter)(this,void 0,void 0,function*(){return yield this.prepareBonusActionData(e,t,"inventory")}),events:{success:"BONUS_TAKE_SUCCEEDED",fail:"BONUS_TAKE_FAILED"}},e);return this.showSuccess(gettext("Bonus success"),gettext("Bonus take success")),i.data}catch(i){this.showError(gettext("Bonus error"),null==i?void 0:i.errors)}})}queryBonuses(t,e,i){return(0,s.__awaiter)(this,void 0,void 0,function*(){this.queryPromises[e||"any"]=!0;const s={};e&&("active"!==e&&"history"!==e||(s.type=e),"store"===e&&(s.event=e)),i&&(s.PromoCode=i);try{const i=yield this.dataService.request("bonuses/bonuses",s);if("history"===e)return t&&this.subjects.history$.next(i.data),this.historyBonuses=i.data,i.data;const r=(0,C.Z)(this.checkForbid(this.modifyBonuses(i.data),s),["id"]);switch(r.length&&(yield this.checkBonusesInCache(r)),e){case"active":t&&this.subjects.active$.next(r),this.activeBonuses=r;break;case"store":t&&this.subjects.store$.next(r),this.storeBonuses=r;break;default:t&&this.subjects.bonuses$.next(r),this.bonuses=r}return r}catch(r){this.logService.sendLog({code:"10.0.0",data:r}),this.eventService.emit({name:"BONUSES_FETCH_FAILED",data:r})}finally{this.queryPromises[e||"any"]=!1}})}clearPromoBonus(){this.promoBonus&&(this.cachingService.clear(this.dbPromoUrl),this.promoBonus=null)}modifyBonuses(t){const e=[];if(null==t?void 0:t.length)for(const i of t){const t=new d.r({service:"BonusesService",method:"modifyBonuses"},i,this.configService,this.cachingService,this.translate,this);t.setFromCache(),e.push(t)}return(0,y.Z)(e,t=>t.allowCatalog||!t.allowCatalog&&(t.selected||t.active))}registerMethods(){this.dataService.registerMethod({name:"bonuses",system:"bonuses",url:"/bonuses",type:"GET"})}checkForbid(t,e){if(!t.length)return t;const i=(0,E.Z)(this.profile,"info.category","").toLowerCase(),s=this.configService.get("$loyalty.forbidBanned");return this.useForbidUserFields&&("1"===(0,E.Z)(this.profile,"info.loyalty.ForbidBonuses")||(0,E.Z)(s,`${i}.forbidBonuses`,!1))&&"history"!==e.type&&(t=(0,y.Z)(t,t=>t.active||t.selected||t.inventoried)),t}checkBonusesInCache(t){return(0,s.__awaiter)(this,void 0,void 0,function*(){const e=(0,h.Z)(t,"id");let i;try{i=(yield this.cachingService.get("bonuses"))||{}}catch(s){i={}}(0,m.Z)(i,(t,s)=>{(0,b.Z)(t)&&0!==t.length?0===(t=(0,y.Z)(t,t=>(0,v.Z)(e,t))).length&&(0,g.Z)(i,s):(0,g.Z)(i,s)}),0!==(0,l.Z)(i)?this.cachingService.set("bonuses",i,!0,Number.MAX_SAFE_INTEGER):this.cachingService.clear("bonuses")})}setSubscribers(){this.subjects.bonuses$.subscribe({next:t=>{this.eventService.emit({name:"BONUSES_FETCH_SUCCESS",data:t})}}),this.subjects.active$.subscribe({next:t=>{this.eventService.emit({name:"BONUSES_FETCH_ACTIVE_SUCCESS",data:t})}}),this.subjects.history$.subscribe({next:t=>{this.eventService.emit({name:"BONUSES_FETCH_HISTORY_SUCCESS",data:t})}}),this.subjects.store$.subscribe({next:t=>{this.eventService.emit({name:"BONUSES_FETCH_STORE_SUCCESS",data:t})}}),this.eventService.filter([{name:"LOGIN"},{name:"LOGOUT"},{name:"PROFILE_UPDATE"},{name:"BONUS_TAKE_SUCCEEDED"},{name:"BONUS_CANCEL_SUCCEEDED"},{name:"BONUS_SUBSCRIBE_SUCCEEDED"},{name:"BONUS_UNSUBSCRIBE_SUCCEEDED"},{name:"PROMO_SUCCESS"}]).subscribe({next:t=>{"LOGIN"!==t.name&&"LOGOUT"!==t.name||(this.bonuses=[],this.subjects.bonuses$.next([])),this.updateSubscribers()}}),this.eventService.subscribe([{name:"LOGOUT"}],()=>{this.clearPromoBonus()}),this.eventService.subscribe([{name:"PROMO_SUCCESS"}],t=>{t&&(this.promoBonus=t,this.cachingService.set(this.dbPromoUrl,this.promoBonus.promoCode,!0,864e4))}),this.translate.onLangChange.subscribe(()=>{this.updateSubscribers()})}showError(t,e){this.eventService.emit({name:c.LA.PushMessage,data:{type:"error",title:t,message:e,wlcElement:"notification_bonus-error"}})}showSuccess(t,e){this.eventService.emit({name:c.LA.PushMessage,data:{type:"success",title:t,message:e,wlcElement:"notification_bonus-success"}})}prepareBonusActionData(t,e,i){return(0,s.__awaiter)(this,void 0,void 0,function*(){switch(yield e.addToCache(i),(0,p.Z)(e.data,t),i){case"inventory":e.data.Inventoried=0;break;case"cancel":e.data.Status=0}return e})}updateSubscribers(){this.subjects.active$.observers.length>1&&this.queryBonuses(!0,"active"),this.subjects.bonuses$.observers.length>1&&this.queryBonuses(!0,"any"),this.subjects.store$.observers.length>1&&this.queryBonuses(!0,"store"),this.subjects.history$.observers.length>1&&this.queryBonuses(!0,"history")}};f.ctorParameters=()=>[{type:c.$P},{type:c.Do},{type:c.PO},{type:c.E4},{type:c.$V},{type:n.sK}],f=(0,s.__decorate)([(0,r.GSi)({providedIn:"root"})],f)},97176:function(t,e,i){"use strict";i.d(e,{d:function(){return s.d}});var s=i(29448)}}]);